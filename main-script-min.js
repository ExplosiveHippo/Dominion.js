function Card(e,t,n,r,i,s,o,u,a,f,l,c){this.name=e;this.actions=t;this.buys=n;this.cost=r;this.worth=i;this.points=s;this.cards=o;this.image=u;this.smallImage=a;this.remaining=f;this.type=l;this.special=c}function CreateTimer(e,t){Timer=document.getElementById(e);TotalSeconds=t;window.setTimeout("Tick()",1e3);UpdateTimer()}function Tick(){if(TotalSeconds<=0){finalScore=calcScore();var e=calcAIScore();console.log("AI final score is: "+e);var t=document.getElementById("winloss");if(finalScore>e){t.innerHTML="You Win!"}else{t.innerHTML="Sorry, AI won!"}var n=document.getElementById("playerscore");n.innerHTML=finalScore;var r=document.getElementById("aiscore");r.innerHTML=e;var i=document.getElementById("scorehidden");i.value=finalScore;$("#addscorebtn").click(function(){var e=$("#name-field").val();addScore(finalScore,e)});document.getElementById("score").style.visibility="visible";for(var s=0;s<actionCards.length;s++){document.getElementsByClassName("buybtn")[s].style.visibility="hidden"}for(var s=0;s<hand.length;s++){if(hand[s].type=="action"){$(".playbtn").css("visibility","hidden")}}return}TotalSeconds-=1;UpdateTimer();window.setTimeout("Tick()",1e3)}function UpdateTimer(){var e=TotalSeconds;var t=Math.floor(e/86400);e-=t*86400;var n=Math.floor(e/3600);e-=n*3600;var r=Math.floor(e/60);e-=r*60;var i=(t>0?t+" days ":"")+LeadingZero(n)+":"+LeadingZero(r)+":"+LeadingZero(e);Timer.innerHTML=i+" Left"}function LeadingZero(e){return e<10?"0"+e:+e}function createActions(){for(var e=0;e<actionCards.length;e++){var t=document.createElement("div");t.setAttribute("class","singleActionCardDiv");var n=new Image;var r=document.createElement("p");r.setAttribute("class","costValue");var i=document.createTextNode(actionCards[e].cost);r.appendChild(i);t.appendChild(r);n.src=actionCards[e].smallImage;var s=new Image;s.setAttribute("class","buybtn");s.src="images/buy-btn.png";s.style.visibility="hidden";t.appendChild(s);if(buys>0){s.addEventListener("click",function(){purchaseCard(this)}.bind(actionCards[e]),false)}n.addEventListener("click",function(){setImage(this)}.bind(actionCards[e]),false);t.appendChild(n);document.getElementById("action-cards").appendChild(t)}}function setImage(e){if(e.type=="action"){alert(e.name+"\n +"+e.cards+" Cards\n +"+e.actions+" Actions\n +"+e.worth+" Extra Treasure\n +"+e.buys+" Buys\n\n"+e.special)}else if(e.type=="treasure"){alert(e.name+"\n"+e.worth+" Treasure\n\n"+e.special)}else if(e.name=="Garden"){alert(e.name+"\n\n"+e.special)}else{alert(e.name+"\n"+e.points+" Victory Points\n\n"+e.special)}}function createDeck(){$("#startbtn").click(function(){$("#welcome").css("visibility","hidden");CreateTimer("timer",300)});$("#scoreboardbtn").click(function(){var e="scoreboard.php";$.post(e,{},function(e){$("#welcome").html(e).show()})});$("#endturn").click(function(){clearHand()});for(var e=0;e<7;e++){deck.push(copper)}for(var t=0;t<3;t++){deck.push(estate)}createActions();deck=Shuffle(deck);drawFive(deck)}function Shuffle(e){for(var t,n,r=e.length;r;t=parseInt(Math.random()*r),n=e[--r],e[r]=e[t],e[t]=n);return e}function randomizeActions(e){for(var t,n,r=e.length;r;t=parseInt(Math.random()*r),n=e[--r],e[r]=e[t],e[t]=n);e=e.slice(0,10);return e}function drawFive(e){actions=1;buys=1;if(e.length<5){e=Shuffle(discard)}for(var t=0;t<5;t++){hand[t]=e.shift()}displayHand(hand,"init")}function displayHand(e,t){if(t=="init"){e.length=5}else{e.length=e.length}document.getElementById("game-hand").innerHTML="";var n=Array();var r=Array();var i=Array();var s=Array();for(var o=0;o<e.length;o++){r[o]=document.createElement("div");r[o].setAttribute("class","singleHandCard");var u=r[o].setAttribute("id","card"+o);document.getElementById("game-hand").appendChild(r[o]);i[o]=new Image;i[o].src=e[o].image;i[o].addEventListener("click",function(){setImage(this)}.bind(e[o]),false);s[o]=new Image;s[o].setAttribute("class","playbtn");s[o].src="images/play-btn.png";s[o].style.visibility="hidden";if(e[o].type=="action"){if(actions>0){s[o].style.visibility="visible"}}r[o].appendChild(s[o]);n[o]=s[o].parentNode;r[o].appendChild(i[o]);cardClick(s[o],n[o],e[o])}calculateTreasure(e)}function cardClick(e,t,n){if(actions>0){e.addEventListener("click",function(){playAction(t,n)}.bind(hand),false)}}function calculateTreasure(e){totalTreasure=0;for(var t=0;t<e.length;t++){if(e[t].type=="treasure"){totalTreasure+=e[t].worth;updateTrackers()}}setupBuy()}function setupBuy(){if(buys>0){for(var e=0;e<actionCards.length;e++){if(actionCards[e].cost<=totalTreasure){document.getElementsByClassName("buybtn")[e].style.visibility="visible"}}}}function purchaseCard(e){buys--;updateTrackers();e.remaining--;if(e.name=="Cache"){for(var t=0;t<3;t++){discard.push(copper)}}if(e.remaining==2){alert("Only 2 "+e.name+"'s remaining!")}discard.push(e);if(buys>=1){totalTreasure-=e.cost;updateTrackers();for(var t=0;t<actionCards.length;t++){document.getElementsByClassName("buybtn")[t].style.visibility="hidden"}setupBuy()}else if(buys<1){clearHand()}}function clearHand(){for(var e=0;e<actionCards.length;e++){document.getElementsByClassName("buybtn")[e].style.visibility="hidden"}for(var e=0;e<hand.length;e++){discard.push(hand[e])}drawFive(deck);drawFiveAI(AIdeck)}function playAction(e,t){if(actions>0){discard.push(t);var n=hand.indexOf(t);hand.splice(n,1);e.innerHTML="";if(t.actions>0){actions+=t.actions}else{}if(t.buys>0){buys+=t.buys}if(t.worth>0){totalTreasure+=t.worth;setupBuy()}if(t.cards>0){var r=t.cards;drawAdditional(r)}actions--;updateTrackers();if(actions<1){for(var i=0;i<hand.length;i++){if(hand[i].type=="action"){$(".playbtn").css("visibility","hidden")}}}}}function drawAdditional(e){if(deck.length<e){deck=Shuffle(discard)}for(var t=0;t<e;t++){hand[hand.length]=deck.shift();if(hand[hand.length-1].type=="treasure"){totalTreasure+=hand[hand.length-1].worth;updateTrackers()}}displayHand(hand,"draw")}function calcScore(){var e=0;var t=Array();for(var n=0;n<hand.length;n++){if(hand[n].points>0){finalScore+=hand[n].points}if(hand[n].name=="garden"){t.push(hand[n])}e++}for(var r=0;r<discard.length;r++){if(discard[r].points>0){finalScore+=discard[r].points}if(discard[r].name=="garden"){t.push(discard[r])}e++}for(var i=0;i<deck.length;i++){if(deck[i].points>0){finalScore+=deck[i].points}if(deck[i].name=="garden"){t.push(deck[i])}e++}if(t.length>0){var s=e/10;for(var o=0;o<t.length;o++){finalScore+=s}}return finalScore}function addScore(e,t){var n="scoreboard.php";$.post(n,{Score:e,Name:t},function(e){$("#score").html(e).show()})}function updateTrackers(){$("#action-tracker").html("Actions: "+actions).show();$("#buy-tracker").html("Buys: "+buys).show();$("#treasure-tracker").html("Treasure: "+totalTreasure).show()}function initAI(){for(var e=0;e<7;e++){AIdeck.push(copper)}for(var t=0;t<3;t++){AIdeck.push(estate)}AIdeck=AIShuffle(AIdeck)}function AIShuffle(e){for(var t,n,r=e.length;r;t=parseInt(Math.random()*r),n=e[--r],e[r]=e[t],e[t]=n);return e}function drawFiveAI(e){turn++;AItotalTreasure=0;e.length=5;console.log("--------- AI turn #"+turn+"---------");AIactions=1;AIbuys=1;if(e.length<5){e=AIShuffle(AIdiscard)}for(var t=0;t<5;t++){AIhand[t]=e.shift();console.log("AI card"+t+"is a "+AIhand[t].name)}calculateAITreasure(AIhand);determineAIActions(AIhand)}function determineAIActions(e){if(AIactions>=1){for(var t=0;t<e.length;t++){if(e[t].type=="action"){AIplayableCards.push(e[t])}}if(AIplayableCards.length>0){AIplayableCards=randomAIBuy(AIplayableCards);AIcardPlay=AIplayableCards.shift();console.log("AI will play a: "+AIcardPlay.name);AIplayAction(AIcardPlay)}else{console.log("AI has no more action cards in their hand");determineAIBuy()}}else{console.log("AI is out of actions!");determineAIBuy()}}function AIplayAction(e){if(AIactions>0){AIdiscard.push(e);var t=AIhand.indexOf(e);AIhand.splice(t,1);if(e.actions>0){AIactions+=e.actions;console.log("AI gets +"+e.actions+" Actions")}if(e.buys>0){AIbuys+=e.buys;console.log("AI gets +"+e.buys+" Buys")}if(e.worth>0){AItotalTreasure+=e.worth;console.log("AI gets +"+e.worth+" Treasure");console.log("AI now has "+AItotalTreasure+" total treasure")}if(e.cards>0){var n=e.cards;console.log("AI gets to draw +"+e.cards+" Cards");AIdrawAdditional(n)}AIactions--;determineAIActions(AIhand)}}function AIdrawAdditional(e){if(AIdeck.length<e){AIdeck=Shuffle(AIdiscard)}for(var t=0;t<e;t++){AIhand[AIhand.length]=AIdeck.shift();if(AIhand[AIhand.length-1].type=="treasure"){AItotalTreasure+=AIhand[AIhand.length-1].worth}console.log("AI drew a: "+AIhand[AIhand.length-1].name)}}function calculateAITreasure(e){AItotalTreasure=0;for(var t=0;t<e.length;t++){if(e[t].type=="treasure"){AItotalTreasure+=e[t].worth}}console.log("AI is starting with: "+AItotalTreasure+" total treasures")}function determineAIBuy(){AIbuyableCards.length=0;if(totalTreasure<9){var e=AItotalTreasure-2;for(var t=0;t<actionCards.length;t++){if(actionCards[t].name!="Estate"&&actionCards[t].name!="Copper"){if(actionCards[t].cost>=e&&actionCards[t].cost<=AItotalTreasure){AIbuyableCards.push(actionCards[t])}}}}else{for(var t=0;t<actionCards.length;t++){if(actionCards[t].name!="Estate"&&actionCards[t].name!="Copper"){if(actionCards[t].cost<=AItotalTreasure){AIbuyableCards.push(actionCards[t])}}}}if(AIbuyableCards.length<1){console.log("The AI has decided not to buy a card this round");AIclearHand()}else{AIbuyableCards=randomAIBuy(AIbuyableCards);AIcardBuy=AIbuyableCards.shift();console.log("AI now has: "+AItotalTreasure+" total treasures");console.log("AI will buy a: "+AIcardBuy.name);AIpurchaseCard(AIcardBuy)}}function randomAIBuy(e){for(var t,n,r=e.length;r;t=parseInt(Math.random()*r),n=e[--r],e[r]=e[t],e[t]=n);return e}function AIpurchaseCard(e){AIbuys--;e.remaining--;if(e.name=="Cache"){for(var t=0;t<3;t++){AIdiscard.push(copper)}}AIdiscard.push(e);AItotalTreasure-=e.cost;if(AIbuys>=1&&AItotalTreasure>3){determineAIBuy();if(AItotalTreasure>0){console.log("AI has another buy!")}}else{AIclearHand()}}function AIclearHand(){console.log("AI has finished their turn");for(var e=0;e<AIhand.length;e++){AIdiscard.push(AIhand[e])}}function calcAIScore(){var e=0;var t=Array();for(var n=0;n<AIhand.length;n++){if(AIhand[n].points>0){AIfinalScore+=AIhand[n].points}if(AIhand[n].name=="garden"){t.push(AIhand[n])}e++}for(var r=0;r<AIdiscard.length;r++){if(AIdiscard[r].points>0){AIfinalScore+=AIdiscard[r].points}if(AIdiscard[r].name=="garden"){t.push(AIdiscard[r])}e++}for(var i=0;i<deck.length;i++){if(AIdeck[i].points>0){AIfinalScore+=AIdeck[i].points}if(AIdeck[i].name=="garden"){t.push(AIdeck[i])}e++}if(t.length>0){var s=e/10;for(var o=0;o<t.length;o++){AIfinalScore+=s}}return AIfinalScore}var copper=new Card("Copper",0,0,0,1,0,0,"CardImages/copper.jpg","CardImages/small/copper.png",30,"treasure","");var silver=new Card("Silver",0,0,3,2,0,0,"CardImages/silver.jpg","CardImages/small/silver.png",20,"treasure","");var gold=new Card("Gold",0,0,6,3,0,0,"CardImages/gold.jpg","CardImages/small/gold.png",15,"treasure","");var estate=new Card("Estate",0,0,2,0,1,0,"CardImages/estate.jpg","CardImages/small/estate.png",30,"victory","");var Duchy=new Card("Duchy",0,0,5,0,3,0,"CardImages/duchy.jpg","CardImages/small/duchy.png",10,"victory","");var province=new Card("Province",0,0,8,0,6,0,"CardImages/province.jpg","CardImages/small/province.png",8,"victory","");var chancellor=new Card("Chancellor",0,0,3,2,0,0,"CardImages/chancellor.jpg","CardImages/small/chancellor.png",10,"action","");var councilroom=new Card("Council Room",0,1,5,0,0,4,"CardImages/councilroom.jpg","CardImages/small/councilroom.png",10,"action","");var festival=new Card("Festival",2,1,5,2,0,0,"CardImages/festival.jpg","CardImages/small/festival.png",10,"action","");var grandmarket=new Card("Grand Market",1,1,6,2,0,1,"CardImages/grandmarket.jpg","CardImages/small/grandmarket.png",10,"action","");var laboratory=new Card("Laboratory",2,0,5,0,0,2,"CardImages/laboratory.jpg","CardImages/small/laboratory.png",10,"action","");var market=new Card("Market",1,1,5,1,0,1,"CardImages/market.jpg","CardImages/small/market.png",10,"action","");var smithy=new Card("Smithy",0,0,4,0,0,3,"CardImages/smithy.jpg","CardImages/small/smithy.png",10,"action","");var village=new Card("Village",2,0,3,0,0,1,"CardImages/village.jpg","CardImages/small/village.png",10,"action","");var woodcutter=new Card("Wood Cutter",0,1,3,2,0,0,"CardImages/woodcutter.jpg","CardImages/small/woodcutter.png",10,"action","");var workersvillage=new Card("Workers Village",2,1,4,0,0,1,"CardImages/workersvillage.jpg","CardImages/small/workersvillage.png",10,"action","");var oasis=new Card("Oasis",1,0,5,1,0,1,"CardImages/oasis.jpg","CardImages/small/oasis.png",10,"action","");var margrave=new Card("Margrave",0,1,5,0,0,3,"CardImages/margrave.jpg","CardImages/small/margrave.png",10,"action","");var bazaar=new Card("Bazaar",2,0,5,1,0,1,"CardImages/bazaar.jpg","CardImages/small/bazaar.png",10,"action","");var cache=new Card("Cache",0,0,5,3,0,0,"CardImages/cache.jpg","CardImages/small/cache.png",10,"treasure","When you buy this card you also gain 2 coppers");var garden=new Card("Garden",0,0,4,0,0,0,"CardImages/garden.jpg","CardImages/small/garden.png",10,"victory","Worth 1 victory point for every 10 cards in your hand");var deck=[];var discard=[];var hand=[];var AIdeck=[];var AIdiscard=[];var AIhand=[];var AIbuyableCards=[];var AIplayableCards=[];var AIactions=1;var AIbuys=1;var AItotalTreasure=0;var AIfinalScore=0;var turn=0;var AIfinalScore=0;var actionCards=[chancellor,councilroom,smithy,village,oasis,margrave,garden,cache,bazaar,festival,laboratory,market,grandmarket];actionCards=randomizeActions(actionCards);actionCards.push(copper,silver,gold,estate,Duchy,province);var actions=1;var buys=1;var totalTreasure=0;var finalScore=0;window.onload=createDeck();window.onload=initAI();var Timer;var TotalSeconds